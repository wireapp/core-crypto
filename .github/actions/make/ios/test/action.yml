name: Run ios test via make
inputs:
  gh-token:
    required: true
  always-run:
    description: Run the test even if dependencies haven't changed
    required: false

runs:
  using: composite

  steps:
    - name: fetch uniffi bindgen artifact
      uses: ./.github/actions/make/uniffi-bindgen
      with:
        gh-token: ${{ inputs.gh-token }}

    - name: fetch ffi library
      uses: ./.github/actions/make/ffi-library
      with:
        gh-token: ${{ inputs.gh-token }}

    - name: download artifacts for ios device
      uses: ./.github/actions/make/ios/build
      with:
        gh-token: ${{ inputs.gh-token }}
        task: ios-device

    - name: download artifacts for ios simulator
      uses: ./.github/actions/make/ios/build
      with:
        gh-token: ${{ inputs.gh-token }}
        task: ios-simulator-arm

    - name: download swift bindings
      uses: ./.github/actions/make/bindings-swift
      with:
        gh-token: ${{ inputs.gh-token }}

    - uses: ./.github/actions/make
      with:
        key: ios-test
        make-rule: ios-test
        always-run: ${{ inputs.always-run }}
        gh-token: ${{ inputs.gh-token }}
