use crate::{
    CryptoKeystoreResult,
    traits::{BorrowPrimaryKey, Entity, EntityBase, EntityGetBorrowed, PrimaryKey, UniqueEntity},
};

#[derive(Debug, Eq, Clone, PartialEq, serde::Serialize, serde::Deserialize)]
pub struct DummyStoreValue;

#[cfg_attr(target_family = "wasm", async_trait::async_trait(?Send))]
#[cfg_attr(not(target_family = "wasm"), async_trait::async_trait)]
impl EntityBase for DummyStoreValue {
    type ConnectionType = crate::connection::KeystoreDatabaseConnection;
    type AutoGeneratedFields = ();
    const COLLECTION_NAME: &'static str = "";
}

impl PrimaryKey for DummyStoreValue {
    type PrimaryKey = Vec<u8>;
    fn primary_key(&self) -> Self::PrimaryKey {
        Vec::new()
    }
}

impl BorrowPrimaryKey for DummyStoreValue {
    type BorrowedPrimaryKey = [u8];
    fn borrow_primary_key(&self) -> &Self::BorrowedPrimaryKey {
        &[]
    }
}

#[cfg_attr(target_family = "wasm", async_trait::async_trait(?Send))]
#[cfg_attr(not(target_family = "wasm"), async_trait::async_trait)]
impl Entity for DummyStoreValue {
    async fn get(_conn: &mut Self::ConnectionType, _key: &Self::PrimaryKey) -> CryptoKeystoreResult<Option<Self>> {
        Ok(None)
    }

    /// Count the number of entities of this type in the database.
    async fn count(_conn: &mut Self::ConnectionType) -> CryptoKeystoreResult<u32> {
        Ok(0)
    }

    /// Retrieve all entities of this type from the database.
    async fn load_all(_conn: &mut Self::ConnectionType) -> CryptoKeystoreResult<Vec<Self>> {
        Ok(Vec::new())
    }
}

#[cfg_attr(target_family = "wasm", async_trait::async_trait(?Send))]
#[cfg_attr(not(target_family = "wasm"), async_trait::async_trait)]
impl EntityGetBorrowed for DummyStoreValue {
    async fn get_borrowed(
        _conn: &mut Self::ConnectionType,
        _key: &Self::BorrowedPrimaryKey,
    ) -> CryptoKeystoreResult<Option<Self>> {
        Ok(None)
    }
}

impl UniqueEntity for DummyStoreValue {
    const KEY: Self::PrimaryKey = Vec::new();
}

#[derive(Debug, Clone, PartialEq, Eq)]
pub struct DummyValue(Vec<u8>);

impl From<&str> for DummyValue {
    fn from(id: &str) -> Self {
        DummyValue(format!("dummy value {id}").into_bytes())
    }
}
