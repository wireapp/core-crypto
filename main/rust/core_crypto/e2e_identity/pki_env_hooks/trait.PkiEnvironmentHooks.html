<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="The PKI Environment Hooks used for external calls during e2e enrollment flow. When communicating with the Identity Provider (IDP)  and Wire server, CoreCrypto delegates to the client app by calling the relevant methods."><title>PkiEnvironmentHooks in core_crypto::e2e_identity::pki_env_hooks - Rust</title><script>if(window.location.protocol!=="file:")document.head.insertAdjacentHTML("beforeend","SourceSerif4-Regular-6b053e98.ttf.woff2,FiraSans-Italic-81dc35de.woff2,FiraSans-Regular-0fe48ade.woff2,FiraSans-MediumItalic-ccf7e434.woff2,FiraSans-Medium-e1aa3f0a.woff2,SourceCodePro-Regular-8badfe75.ttf.woff2,SourceCodePro-Semibold-aa29a496.ttf.woff2".split(",").map(f=>`<link rel="preload" as="font" type="font/woff2"href="../../../static.files/${f}">`).join(""))</script><link rel="stylesheet" href="../../../static.files/normalize-9960930a.css"><link rel="stylesheet" href="../../../static.files/rustdoc-ca0dd0c4.css"><meta name="rustdoc-vars" data-root-path="../../../" data-static-root-path="../../../static.files/" data-current-crate="core_crypto" data-themes="" data-resource-suffix="" data-rustdoc-version="1.93.0 (254b59607 2026-01-19)" data-channel="1.93.0" data-search-js="search-9e2438ea.js" data-stringdex-js="stringdex-a3946164.js" data-settings-js="settings-c38705f0.js" ><script src="../../../static.files/storage-e2aeef58.js"></script><script defer src="sidebar-items.js"></script><script defer src="../../../static.files/main-a410ff4d.js"></script><noscript><link rel="stylesheet" href="../../../static.files/noscript-263c88ec.css"></noscript><link rel="alternate icon" type="image/png" href="../../../static.files/favicon-32x32-eab170b8.png"><link rel="icon" type="image/svg+xml" href="../../../static.files/favicon-044be391.svg"></head><body class="rustdoc trait"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><rustdoc-topbar><h2><a href="#">PkiEnvironmentHooks</a></h2></rustdoc-topbar><nav class="sidebar"><div class="sidebar-crate"><h2><a href="../../../core_crypto/index.html">core_<wbr>crypto</a><span class="version">9.0.1</span></h2></div><div class="sidebar-elems"><section id="rustdoc-toc"><h2 class="location"><a href="#">PkiEnvironment<wbr>Hooks</a></h2><h3><a href="#required-methods">Required Methods</a></h3><ul class="block"><li><a href="#tymethod.authenticate" title="authenticate">authenticate</a></li><li><a href="#tymethod.fetch_backend_access_token" title="fetch_backend_access_token">fetch_backend_access_token</a></li><li><a href="#tymethod.get_backend_nonce" title="get_backend_nonce">get_backend_nonce</a></li><li><a href="#tymethod.http_request" title="http_request">http_request</a></li></ul><h3><a href="#implementors">Implementors</a></h3></section><div id="rustdoc-modnav"><h2><a href="index.html">In core_<wbr>crypto::<wbr>e2e_<wbr>identity::<wbr>pki_<wbr>env_<wbr>hooks</a></h2></div></div></nav><div class="sidebar-resizer" title="Drag to resize sidebar"></div><main><div class="width-limiter"><section id="main-content" class="content"><div class="main-heading"><div class="rustdoc-breadcrumbs"><a href="../../index.html">core_crypto</a>::<wbr><a href="../index.html">e2e_identity</a>::<wbr><a href="index.html">pki_env_hooks</a></div><h1>Trait <span class="trait">PkiEnvironment<wbr>Hooks</span>&nbsp;<button id="copy-path" title="Copy item path to clipboard">Copy item path</button></h1><rustdoc-toolbar></rustdoc-toolbar><span class="sub-heading"><a class="src" href="../../../src/core_crypto/e2e_identity/pki_env_hooks.rs.html#69-106">Source</a> </span></div><pre class="rust item-decl"><code>pub trait PkiEnvironmentHooks:
    <a class="trait" href="https://doc.rust-lang.org/1.93.0/core/fmt/trait.Debug.html" title="trait core::fmt::Debug">Debug</a>
    + <a class="trait" href="https://doc.rust-lang.org/1.93.0/core/marker/trait.Send.html" title="trait core::marker::Send">Send</a>
    + <a class="trait" href="https://doc.rust-lang.org/1.93.0/core/marker/trait.Sync.html" title="trait core::marker::Sync">Sync</a> {
    // Required methods
    fn <a href="#tymethod.http_request" class="fn">http_request</a>&lt;'life0, 'async_trait&gt;(
        &amp;'life0 self,
        method: <a class="enum" href="enum.HttpMethod.html" title="enum core_crypto::e2e_identity::pki_env_hooks::HttpMethod">HttpMethod</a>,
        url: <a class="struct" href="https://doc.rust-lang.org/1.93.0/alloc/string/struct.String.html" title="struct alloc::string::String">String</a>,
        headers: <a class="struct" href="https://doc.rust-lang.org/1.93.0/alloc/vec/struct.Vec.html" title="struct alloc::vec::Vec">Vec</a>&lt;<a class="struct" href="struct.HttpHeader.html" title="struct core_crypto::e2e_identity::pki_env_hooks::HttpHeader">HttpHeader</a>&gt;,
        body: <a class="struct" href="https://doc.rust-lang.org/1.93.0/alloc/vec/struct.Vec.html" title="struct alloc::vec::Vec">Vec</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/1.93.0/std/primitive.u8.html">u8</a>&gt;,
    ) -&gt; <a class="struct" href="https://doc.rust-lang.org/1.93.0/core/pin/struct.Pin.html" title="struct core::pin::Pin">Pin</a>&lt;<a class="struct" href="https://doc.rust-lang.org/1.93.0/alloc/boxed/struct.Box.html" title="struct alloc::boxed::Box">Box</a>&lt;dyn <a class="trait" href="https://doc.rust-lang.org/1.93.0/core/future/future/trait.Future.html" title="trait core::future::future::Future">Future</a>&lt;Output = <a class="struct" href="struct.HttpResponse.html" title="struct core_crypto::e2e_identity::pki_env_hooks::HttpResponse">HttpResponse</a>&gt; + <a class="trait" href="https://doc.rust-lang.org/1.93.0/core/marker/trait.Send.html" title="trait core::marker::Send">Send</a> + 'async_trait&gt;&gt;
       <span class="where">where Self: 'async_trait,
             'life0: 'async_trait</span>;
<span class="item-spacer"></span>    fn <a href="#tymethod.authenticate" class="fn">authenticate</a>&lt;'life0, 'async_trait&gt;(
        &amp;'life0 self,
        idp: <a class="struct" href="https://doc.rust-lang.org/1.93.0/alloc/string/struct.String.html" title="struct alloc::string::String">String</a>,
        key_auth: <a class="struct" href="https://doc.rust-lang.org/1.93.0/alloc/string/struct.String.html" title="struct alloc::string::String">String</a>,
        acme_aud: <a class="struct" href="https://doc.rust-lang.org/1.93.0/alloc/string/struct.String.html" title="struct alloc::string::String">String</a>,
    ) -&gt; <a class="struct" href="https://doc.rust-lang.org/1.93.0/core/pin/struct.Pin.html" title="struct core::pin::Pin">Pin</a>&lt;<a class="struct" href="https://doc.rust-lang.org/1.93.0/alloc/boxed/struct.Box.html" title="struct alloc::boxed::Box">Box</a>&lt;dyn <a class="trait" href="https://doc.rust-lang.org/1.93.0/core/future/future/trait.Future.html" title="trait core::future::future::Future">Future</a>&lt;Output = <a class="enum" href="https://doc.rust-lang.org/1.93.0/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;<a class="struct" href="https://doc.rust-lang.org/1.93.0/alloc/string/struct.String.html" title="struct alloc::string::String">String</a>, <a class="struct" href="struct.PkiEnvironmentHooksError.html" title="struct core_crypto::e2e_identity::pki_env_hooks::PkiEnvironmentHooksError">PkiEnvironmentHooksError</a>&gt;&gt; + <a class="trait" href="https://doc.rust-lang.org/1.93.0/core/marker/trait.Send.html" title="trait core::marker::Send">Send</a> + 'async_trait&gt;&gt;
       <span class="where">where Self: 'async_trait,
             'life0: 'async_trait</span>;
<span class="item-spacer"></span>    fn <a href="#tymethod.get_backend_nonce" class="fn">get_backend_nonce</a>&lt;'life0, 'async_trait&gt;(
        &amp;'life0 self,
    ) -&gt; <a class="struct" href="https://doc.rust-lang.org/1.93.0/core/pin/struct.Pin.html" title="struct core::pin::Pin">Pin</a>&lt;<a class="struct" href="https://doc.rust-lang.org/1.93.0/alloc/boxed/struct.Box.html" title="struct alloc::boxed::Box">Box</a>&lt;dyn <a class="trait" href="https://doc.rust-lang.org/1.93.0/core/future/future/trait.Future.html" title="trait core::future::future::Future">Future</a>&lt;Output = <a class="enum" href="https://doc.rust-lang.org/1.93.0/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;<a class="struct" href="https://doc.rust-lang.org/1.93.0/alloc/string/struct.String.html" title="struct alloc::string::String">String</a>, <a class="struct" href="struct.PkiEnvironmentHooksError.html" title="struct core_crypto::e2e_identity::pki_env_hooks::PkiEnvironmentHooksError">PkiEnvironmentHooksError</a>&gt;&gt; + <a class="trait" href="https://doc.rust-lang.org/1.93.0/core/marker/trait.Send.html" title="trait core::marker::Send">Send</a> + 'async_trait&gt;&gt;
       <span class="where">where Self: 'async_trait,
             'life0: 'async_trait</span>;
<span class="item-spacer"></span>    fn <a href="#tymethod.fetch_backend_access_token" class="fn">fetch_backend_access_token</a>&lt;'life0, 'async_trait&gt;(
        &amp;'life0 self,
        dpop: <a class="struct" href="https://doc.rust-lang.org/1.93.0/alloc/string/struct.String.html" title="struct alloc::string::String">String</a>,
    ) -&gt; <a class="struct" href="https://doc.rust-lang.org/1.93.0/core/pin/struct.Pin.html" title="struct core::pin::Pin">Pin</a>&lt;<a class="struct" href="https://doc.rust-lang.org/1.93.0/alloc/boxed/struct.Box.html" title="struct alloc::boxed::Box">Box</a>&lt;dyn <a class="trait" href="https://doc.rust-lang.org/1.93.0/core/future/future/trait.Future.html" title="trait core::future::future::Future">Future</a>&lt;Output = <a class="enum" href="https://doc.rust-lang.org/1.93.0/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;<a class="struct" href="https://doc.rust-lang.org/1.93.0/alloc/string/struct.String.html" title="struct alloc::string::String">String</a>, <a class="struct" href="struct.PkiEnvironmentHooksError.html" title="struct core_crypto::e2e_identity::pki_env_hooks::PkiEnvironmentHooksError">PkiEnvironmentHooksError</a>&gt;&gt; + <a class="trait" href="https://doc.rust-lang.org/1.93.0/core/marker/trait.Send.html" title="trait core::marker::Send">Send</a> + 'async_trait&gt;&gt;
       <span class="where">where Self: 'async_trait,
             'life0: 'async_trait</span>;
}</code></pre><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>The PKI Environment Hooks used for external calls during e2e enrollment flow.
When communicating with the Identity Provider (IDP)  and Wire server,
CoreCrypto delegates to the client app by calling the relevant methods.</p>
<p>Client App                 CoreCrypto                     Acme                     IDP
|                           |                          |                        |
| X509CredentialAcquisition().finalize()               |                        |
|–––––––––––––&gt;|                          |                        |
|                           | GET acme/root.pem        |                        |
|                           |————————&gt; |                        |
|                           | 200 OK                   |                        |
|                           |&lt;———————— |                        |
| authenticate()            |                          |                        |
|&lt;–––––––––––––|                          |                        |
|                           | Authentication flow      |                        |
| ––––––––––––––––––––––––––––––––––––––&gt; |
|&lt;—————————————————————————– |
| return Success [PkiEnvironmentHooks.authenticate()]  |                        |
|&lt;–––––––––––––|                          |                        |
|                           |  (excluded several calls for brevity)             |
| return Success(Credential) [X509CredentialAcquisition().finalize()]           |
|&lt;–––––––––––––|                          |                        |</p>
</div></details><h2 id="required-methods" class="section-header">Required Methods<a href="#required-methods" class="anchor">§</a></h2><div class="methods"><details class="toggle method-toggle" open><summary><section id="tymethod.http_request" class="method"><a class="src rightside" href="../../../src/core_crypto/e2e_identity/pki_env_hooks.rs.html#72-78">Source</a><h4 class="code-header">fn <a href="#tymethod.http_request" class="fn">http_request</a>&lt;'life0, 'async_trait&gt;(
    &amp;'life0 self,
    method: <a class="enum" href="enum.HttpMethod.html" title="enum core_crypto::e2e_identity::pki_env_hooks::HttpMethod">HttpMethod</a>,
    url: <a class="struct" href="https://doc.rust-lang.org/1.93.0/alloc/string/struct.String.html" title="struct alloc::string::String">String</a>,
    headers: <a class="struct" href="https://doc.rust-lang.org/1.93.0/alloc/vec/struct.Vec.html" title="struct alloc::vec::Vec">Vec</a>&lt;<a class="struct" href="struct.HttpHeader.html" title="struct core_crypto::e2e_identity::pki_env_hooks::HttpHeader">HttpHeader</a>&gt;,
    body: <a class="struct" href="https://doc.rust-lang.org/1.93.0/alloc/vec/struct.Vec.html" title="struct alloc::vec::Vec">Vec</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/1.93.0/std/primitive.u8.html">u8</a>&gt;,
) -&gt; <a class="struct" href="https://doc.rust-lang.org/1.93.0/core/pin/struct.Pin.html" title="struct core::pin::Pin">Pin</a>&lt;<a class="struct" href="https://doc.rust-lang.org/1.93.0/alloc/boxed/struct.Box.html" title="struct alloc::boxed::Box">Box</a>&lt;dyn <a class="trait" href="https://doc.rust-lang.org/1.93.0/core/future/future/trait.Future.html" title="trait core::future::future::Future">Future</a>&lt;Output = <a class="struct" href="struct.HttpResponse.html" title="struct core_crypto::e2e_identity::pki_env_hooks::HttpResponse">HttpResponse</a>&gt; + <a class="trait" href="https://doc.rust-lang.org/1.93.0/core/marker/trait.Send.html" title="trait core::marker::Send">Send</a> + 'async_trait&gt;&gt;<div class="where">where
    Self: 'async_trait,
    'life0: 'async_trait,</div></h4></section></summary><div class="docblock"><p>Make an HTTP request
Used for requests to ACME servers, CRL distributors etc.</p>
</div></details><details class="toggle method-toggle" open><summary><section id="tymethod.authenticate" class="method"><a class="src rightside" href="../../../src/core_crypto/e2e_identity/pki_env_hooks.rs.html#91-96">Source</a><h4 class="code-header">fn <a href="#tymethod.authenticate" class="fn">authenticate</a>&lt;'life0, 'async_trait&gt;(
    &amp;'life0 self,
    idp: <a class="struct" href="https://doc.rust-lang.org/1.93.0/alloc/string/struct.String.html" title="struct alloc::string::String">String</a>,
    key_auth: <a class="struct" href="https://doc.rust-lang.org/1.93.0/alloc/string/struct.String.html" title="struct alloc::string::String">String</a>,
    acme_aud: <a class="struct" href="https://doc.rust-lang.org/1.93.0/alloc/string/struct.String.html" title="struct alloc::string::String">String</a>,
) -&gt; <a class="struct" href="https://doc.rust-lang.org/1.93.0/core/pin/struct.Pin.html" title="struct core::pin::Pin">Pin</a>&lt;<a class="struct" href="https://doc.rust-lang.org/1.93.0/alloc/boxed/struct.Box.html" title="struct alloc::boxed::Box">Box</a>&lt;dyn <a class="trait" href="https://doc.rust-lang.org/1.93.0/core/future/future/trait.Future.html" title="trait core::future::future::Future">Future</a>&lt;Output = <a class="enum" href="https://doc.rust-lang.org/1.93.0/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;<a class="struct" href="https://doc.rust-lang.org/1.93.0/alloc/string/struct.String.html" title="struct alloc::string::String">String</a>, <a class="struct" href="struct.PkiEnvironmentHooksError.html" title="struct core_crypto::e2e_identity::pki_env_hooks::PkiEnvironmentHooksError">PkiEnvironmentHooksError</a>&gt;&gt; + <a class="trait" href="https://doc.rust-lang.org/1.93.0/core/marker/trait.Send.html" title="trait core::marker::Send">Send</a> + 'async_trait&gt;&gt;<div class="where">where
    Self: 'async_trait,
    'life0: 'async_trait,</div></h4></section></summary><div class="docblock"><p>Authenticate with the user’s identity provider (IdP)</p>
<p>The implementation should perform an [authentication using the authorization code flow]
(<a href="https://openid.net/specs/openid-connect-core-1_0.html#CodeFlowAuth">https://openid.net/specs/openid-connect-core-1_0.html#CodeFlowAuth</a>) with the PKCE
(<a href="https://www.rfc-editor.org/rfc/rfc7636">https://www.rfc-editor.org/rfc/rfc7636</a>) extension. As part of the authorization
request, the implementation should specify <code>key_auth</code> and <code>acme_aud</code> claims, along with
their values, in the <code>claims</code> parameter. This is to instruct the IdP to add the <code>key_auth</code>
and <code>acme_aud</code> claims to the ID token that will be returned as part of the access token.</p>
<p>Once the authentication is completed successfully, the implementation should request
an access token from the IdP, extract the ID token from it and return it to the caller.</p>
</div></details><details class="toggle method-toggle" open><summary><section id="tymethod.get_backend_nonce" class="method"><a class="src rightside" href="../../../src/core_crypto/e2e_identity/pki_env_hooks.rs.html#99">Source</a><h4 class="code-header">fn <a href="#tymethod.get_backend_nonce" class="fn">get_backend_nonce</a>&lt;'life0, 'async_trait&gt;(
    &amp;'life0 self,
) -&gt; <a class="struct" href="https://doc.rust-lang.org/1.93.0/core/pin/struct.Pin.html" title="struct core::pin::Pin">Pin</a>&lt;<a class="struct" href="https://doc.rust-lang.org/1.93.0/alloc/boxed/struct.Box.html" title="struct alloc::boxed::Box">Box</a>&lt;dyn <a class="trait" href="https://doc.rust-lang.org/1.93.0/core/future/future/trait.Future.html" title="trait core::future::future::Future">Future</a>&lt;Output = <a class="enum" href="https://doc.rust-lang.org/1.93.0/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;<a class="struct" href="https://doc.rust-lang.org/1.93.0/alloc/string/struct.String.html" title="struct alloc::string::String">String</a>, <a class="struct" href="struct.PkiEnvironmentHooksError.html" title="struct core_crypto::e2e_identity::pki_env_hooks::PkiEnvironmentHooksError">PkiEnvironmentHooksError</a>&gt;&gt; + <a class="trait" href="https://doc.rust-lang.org/1.93.0/core/marker/trait.Send.html" title="trait core::marker::Send">Send</a> + 'async_trait&gt;&gt;<div class="where">where
    Self: 'async_trait,
    'life0: 'async_trait,</div></h4></section></summary><div class="docblock"><p>Get a nonce from the backend</p>
</div></details><details class="toggle method-toggle" open><summary><section id="tymethod.fetch_backend_access_token" class="method"><a class="src rightside" href="../../../src/core_crypto/e2e_identity/pki_env_hooks.rs.html#105">Source</a><h4 class="code-header">fn <a href="#tymethod.fetch_backend_access_token" class="fn">fetch_backend_access_token</a>&lt;'life0, 'async_trait&gt;(
    &amp;'life0 self,
    dpop: <a class="struct" href="https://doc.rust-lang.org/1.93.0/alloc/string/struct.String.html" title="struct alloc::string::String">String</a>,
) -&gt; <a class="struct" href="https://doc.rust-lang.org/1.93.0/core/pin/struct.Pin.html" title="struct core::pin::Pin">Pin</a>&lt;<a class="struct" href="https://doc.rust-lang.org/1.93.0/alloc/boxed/struct.Box.html" title="struct alloc::boxed::Box">Box</a>&lt;dyn <a class="trait" href="https://doc.rust-lang.org/1.93.0/core/future/future/trait.Future.html" title="trait core::future::future::Future">Future</a>&lt;Output = <a class="enum" href="https://doc.rust-lang.org/1.93.0/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;<a class="struct" href="https://doc.rust-lang.org/1.93.0/alloc/string/struct.String.html" title="struct alloc::string::String">String</a>, <a class="struct" href="struct.PkiEnvironmentHooksError.html" title="struct core_crypto::e2e_identity::pki_env_hooks::PkiEnvironmentHooksError">PkiEnvironmentHooksError</a>&gt;&gt; + <a class="trait" href="https://doc.rust-lang.org/1.93.0/core/marker/trait.Send.html" title="trait core::marker::Send">Send</a> + 'async_trait&gt;&gt;<div class="where">where
    Self: 'async_trait,
    'life0: 'async_trait,</div></h4></section></summary><div class="docblock"><p>Fetch an access token to be used for the DPoP challenge (<code>wire-dpop-01</code>)</p>
<p>The implementation should take the provided DPoP token (<code>dpop</code>) and make a request to the
backend to obtain an access token, which should be returned to the caller.</p>
</div></details></div><h2 id="implementors" class="section-header">Implementors<a href="#implementors" class="anchor">§</a></h2><div id="implementors-list"></div><script src="../../../trait.impl/core_crypto/e2e_identity/pki_env_hooks/trait.PkiEnvironmentHooks.js" async></script></section></div></main></body></html>