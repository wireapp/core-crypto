[workspace]
members = [
    "crypto",
    "crypto-ffi",
    "crypto-attributes",
    "keystore",
    "mls-provider",
    "interop"
]
exclude = [
    "xtask",
    "extras/anycrypto",
    "extras/core-ds",
    "extras/wasm-browser-run",
    "extras/wasm-browser-test-runner"
]
resolver = "2"

[patch.crates-io.rexie]
git = "https://github.com/otak/rexie"
branch = "feat/api-expansion"

[patch.'https://github.com/wireapp/proteus'.proteus]
package = "proteus"
# Keep the extra / in the url, it prevents this error:
# `patch for `proteus` in `https://github.com/wireapp/proteus` points to the same source, but patches must point to different sources`
git = "https://github.com/wireapp//proteus"
branch = "otak/fix-1.0.3"

[patch.crates-io.proteus-traits]
package = "proteus-traits"
git = "https://github.com/wireapp/proteus"
branch = "otak/2.0-error-codes"

[patch.crates-io.openmls]
package = "openmls"
git = "https://github.com/wireapp/openmls"
tag = "v0.5.4-pre.core-crypto-0.7.0"

[patch.crates-io.openmls_traits]
package = "openmls_traits"
git = "https://github.com/wireapp/openmls"
tag = "v0.5.4-pre.core-crypto-0.7.0"

[patch.crates-io.hpke-rs]
git = "https://github.com/wireapp/hpke-rs"
branch = "feat/0.2"
package = "hpke-rs"

[patch.crates-io.hpke-rs-crypto]
git = "https://github.com/wireapp/hpke-rs"
branch = "feat/0.2"
package = "hpke-rs-crypto"

[patch.crates-io.hpke-rs-rust-crypto]
git = "https://github.com/wireapp/hpke-rs"
branch = "feat/0.2"
package = "hpke-rs-rust-crypto"

[patch.crates-io.rcgen]
git = "https://github.com/wireapp/rcgen"
tag = "v1.2.0-pre.core-crypto-0.6.0"

# aarch64-apple-ios-sim target support has not yet been released
[patch.crates-io.openssl-src]
git = "https://github.com/alexcrichton/openssl-src-rs.git"
branch = "release/111"
package = "openssl-src"

[patch.crates-io.wire-e2e-identity]
git = "https://github.com/wireapp/rusty-jwt-tools"
package = "wire-e2e-identity"
tag = "v0.3.1"

[patch.crates-io.jwt-simple]
git = "https://github.com/wireapp/rust-jwt-simple"
tag = "v0.11.4-pre.core-crypto-0.7.0"

[patch.crates-io.biscuit]
git = "https://github.com/beltram/biscuit"
tag = "v0.6.0-pre.core-crypto-0.6.0"

# Needed for quick mode and (later) result comparison see (https://www.tweag.io/blog/2022-03-03-criterion-rs/)
# TODO: remove once branch got merged in 0.4 release
[patch.crates-io.criterion]
git = "https://github.com/bheisler/criterion.rs"
branch = "version-0.4"

[profile.release]
lto = true
codegen-units = 1
opt-level = "s"
# panic = "abort"

# [profile.dev.package.backtrace]
# opt-level = 3
