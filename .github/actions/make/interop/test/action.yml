name: Run e2e interop test via make
inputs:
  gh-token:
    required: true
  always-run:
    description: Run the test even if dependencies haven't changed
    required: false

runs:
  using: composite

  steps:
    - name: download web bindings
      uses: ./.github/actions/make/web/ts
      with:
        gh-token: ${{ inputs.gh-token }}

    - name: download artifacts for ios device
      uses: ./.github/actions/make/ios/build
      with:
        gh-token: ${{ inputs.gh-token }}
        task: ios-device

    - name: download artifacts for ios simulator
      uses: ./.github/actions/make/ios/build
      with:
        gh-token: ${{ inputs.gh-token }}
        task: ios-simulator-arm

    - name: download swift bindings
      uses: ./.github/actions/make/bindings-swift
      with:
        gh-token: ${{ inputs.gh-token }}

    - name: download android package
      uses: ./.github/actions/make/android/package
      with:
        gh-token: ${{ inputs.gh-token }}

    - name: download interop test binary
      uses: ./.github/actions/make/interop/build
      with:
        gh-token: ${{ inputs.gh-token }}

    - uses: ./.github/actions/make
      env:
        RUST_LOG: interop=info
      with:
        key: interop-test
        make-rule: interop-test
        always-run: ${{ inputs.always-run }}
        gh-token: ${{ inputs.gh-token }}
